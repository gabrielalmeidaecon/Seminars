<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Goethe Seminars – Upcoming Events</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-card: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --border: #1f2933;
      --radius: 0.75rem;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    header {
      padding: 1.5rem 1.25rem 0.5rem;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
    }

    .page-notice {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.6rem 0.95rem;
      margin-bottom: 1rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(56,189,248,0.35);
      background: linear-gradient(135deg, rgba(56,189,248,0.18), rgba(15,23,42,0.92));
      color: var(--text);
      font-size: 0.82rem;
    }

    .page-notice strong {
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .page-notice a {
      color: inherit;
      font-weight: 600;
      text-decoration: none;
    }

    .page-notice a:hover {
      text-decoration: underline;
    }

    h1 {
      margin: 0 0 0.25rem;
      font-size: clamp(1.6rem, 3vw, 2.1rem);
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    main {
      flex: 1;
      width: 100%;
      max-width: 1100px;
      margin: 0 auto 2rem;
      padding: 0 1.25rem 2rem;
    }

    .panel {
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.99));
      border-radius: 1rem;
      border: 1px solid rgba(148,163,184,0.15);
      box-shadow: 0 18px 45px rgba(15,23,42,0.8);
      padding: 1rem 1rem 1.25rem;
      backdrop-filter: blur(18px);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .filters-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      flex: 1 1 260px;
      min-width: 0;
    }

    label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--text-muted);
      display: block;
      margin-bottom: 0.25rem;
    }

    select,
    input[type="search"] {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.95);
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    select:focus,
    input[type="search"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
      background: #020617;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid rgba(148,163,184,0.4);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(56,189,248,0.8);
    }

    .table-wrapper {
      margin-top: 0.5rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(31,41,55,0.9);
      overflow: hidden;
      background: radial-gradient(circle at top left, rgba(15,23,42,0.96), rgba(2,6,23,0.98));
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
    }

    thead {
      background: radial-gradient(circle at top right, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
    }

    th,
    td {
      padding: 0.6rem 0.75rem;
      text-align: left;
      border-bottom: 1px solid rgba(15,23,42,0.95);
    }

    th {
      position: sticky;
      top: 0;
      z-index: 1;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--text-muted);
      background: rgba(15,23,42,0.98);
    }

    tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.96);
    }

    tbody tr:nth-child(odd) {
      background: rgba(8,17,35,0.96);
    }

    tbody tr:hover {
      background: rgba(15,23,42,1);
    }

    .col-date {
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
    }

    .col-seminar {
      font-weight: 500;
    }

    .col-title {
      max-width: 280px;
    }

    .col-title span {
      display: block;
      overflow-wrap: anywhere;
      white-space: normal;
    }

    .col-speaker {
      max-width: 190px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.72rem;
      text-decoration: none;
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--text);
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
      cursor: pointer;
      white-space: nowrap;
      transition: border-color 0.18s ease, background 0.18s ease, transform 0.1s ease;
    }

    .btn-primary {
      border-color: rgba(56,189,248,0.8);
      background: linear-gradient(135deg, rgba(56,189,248,0.18), rgba(56,189,248,0.06));
    }

    .btn:hover {
      transform: translateY(-1px);
      border-color: var(--accent);
      background: linear-gradient(145deg, rgba(15,23,42,1), rgba(15,23,42,0.98));
    }

    .btn:active {
      transform: translateY(0);
    }

    .empty {
      text-align: center;
      padding: 1.5rem 0.75rem;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .pill-info {
      margin-top: 0.4rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .pill-info span {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148,163,184,0.8);
    }

    @media (max-width: 900px) {
      header {
        padding-inline: 1rem;
      }

      main {
        padding-inline: 1rem 1.25rem;
      }

      .filters {
        gap: 0.6rem;
      }

      .panel {
        padding-inline: 0.85rem;
      }
    }

    @media (max-width: 720px) {
      body {
        background: radial-gradient(circle at top, #111c31, #020617 60%);
      }

      header {
        padding-inline: 0.85rem;
      }

      main {
        padding-inline: 0.85rem;
      }

      .panel {
        padding: 1rem 0.85rem 1.1rem;
        border-radius: 1.1rem;
        border: 1px solid rgba(148,163,184,0.18);
        box-shadow: 0 22px 48px rgba(8,15,35,0.65);
      }

      .filters {
        flex-direction: column;
        align-items: stretch;
        gap: 0.9rem;
      }

      .filters-group {
        flex: 1 1 auto;
        width: 100%;
      }

      .badge {
        justify-content: flex-start;
        width: 100%;
      }

      .table-wrapper {
        background: transparent;
        border: none;
        overflow: visible;
        margin-top: 0.9rem;
      }

      table {
        display: block;
        width: 100%;
      }

      thead {
        display: none;
      }

      tbody {
        display: grid;
        gap: 1rem;
      }

      tbody tr {
        display: grid;
        gap: 0.75rem;
        padding: 1rem 1rem 1.15rem;
        border-radius: 1rem;
        border: 1px solid rgba(148,163,184,0.16);
        background: linear-gradient(145deg, rgba(15,23,42,0.97), rgba(2,6,23,0.98));
        box-shadow: 0 24px 45px rgba(5,10,25,0.65);
      }

      tbody tr:nth-child(even),
      tbody tr:nth-child(odd) {
        background: linear-gradient(145deg, rgba(15,23,42,0.97), rgba(2,6,23,0.98));
      }

      tbody tr:hover {
        border-color: rgba(56,189,248,0.35);
        background: linear-gradient(135deg, rgba(15,23,42,1), rgba(15,23,42,0.96));
      }

      td {
        display: grid;
        gap: 0.35rem;
        padding: 0;
        border: none;
      }

      td::before {
        content: attr(data-label);
        font-size: 0.62rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--text-muted);
      }

      td.empty {
        display: block;
        padding: 1.35rem 0.75rem;
        border-radius: 0.9rem;
        background: linear-gradient(145deg, rgba(15,23,42,0.9), rgba(15,23,42,0.96));
      }

      td.empty::before {
        display: none;
      }

      .col-date {
        font-size: 1.05rem;
        font-weight: 600;
        letter-spacing: 0.06em;
      }

      .col-title span {
        -webkit-line-clamp: unset;
        white-space: normal;
      }

      .btn-row {
        justify-content: flex-start;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="page-notice">
      <strong>Contact</strong>
      <span>
        Should you notice an issue on this page, please reach out to
        <a href="mailto:gabriel.almeida@stud.uni-frankfurt.de">gabriel.almeida@stud.uni-frankfurt.de</a>.
      </span>
    </div>
    <h1>Goethe Seminars</h1>
    <p class="subtitle">Upcoming research seminars at Goethe University Frankfurt &amp; IMFS</p>
  </header>

  <main>
    <section class="panel">
      <div class="filters">
        <div class="filters-group">
          <div style="flex: 1 1 180px; min-width: 0;">
            <label for="seminarFilter">Seminar series</label>
            <select id="seminarFilter">
              <option value="all">All seminar series</option>
            </select>
          </div>
          <div style="flex: 1 1 180px; min-width: 0;">
            <label for="searchInput">Search (speaker, title, location)</label>
            <input id="searchInput" type="search" placeholder="Type to filter…" />
          </div>
        </div>
        <div class="badge">
          <span class="badge-dot"></span>
          <span id="countBadge">Loading events…</span>
        </div>
      </div>

      <div class="pill-info">
        <span><span class="pill-dot"></span> Only future talks are shown</span>
        <span><span class="pill-dot"></span> Times and rooms are indicative — always double-check the seminar page</span>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Seminar</th>
              <th>Speaker</th>
              <th>Title</th>
              <th>Time</th>
              <th>Location</th>
              <th>Links</th>
            </tr>
          </thead>
          <tbody id="eventsBody">
            <tr>
              <td colspan="7" class="empty">Loading…</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const eventsBody = document.getElementById("eventsBody");
    const seminarFilter = document.getElementById("seminarFilter");
    const searchInput = document.getElementById("searchInput");
    const countBadge = document.getElementById("countBadge");

    let allEvents = [];

    function formatDate(iso) {
      if (!iso) return "";
      const [y, m, d] = iso.split("-");
      return `${d}.${m}.${y}`;
    }

    function buildSeminarMap(events) {
      const map = new Map();
      for (const ev of events) {
        if (!map.has(ev.seminar_id)) {
          map.set(ev.seminar_id, ev.seminar_name || ev.seminar_id);
        }
      }
      return map;
    }

    function populateSeminarFilter(events) {
      const map = buildSeminarMap(events);
      for (const [id, name] of map.entries()) {
        const opt = document.createElement("option");
        opt.value = id;
        opt.textContent = name;
        seminarFilter.appendChild(opt);
      }
    }

    function render(events) {
      eventsBody.innerHTML = "";

      const today = new Date().toISOString().slice(0, 10);
      const upcoming = events.filter(ev => ev.date >= today);

      if (!upcoming.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 7;
        td.className = "empty";
        td.textContent = "No matching upcoming events.";
        tr.appendChild(td);
        eventsBody.appendChild(tr);
        countBadge.textContent = "0 upcoming events";
        return;
      }

      const count = upcoming.length;
      countBadge.textContent = count === 1 ? "1 upcoming event" : `${count} upcoming events`;

      for (const ev of upcoming) {
        const tr = document.createElement("tr");

        const tdDate = document.createElement("td");
        tdDate.className = "col-date";
        tdDate.dataset.label = "Date";
        tdDate.textContent = formatDate(ev.date);
        tr.appendChild(tdDate);

        const tdSeminar = document.createElement("td");
        tdSeminar.className = "col-seminar";
        tdSeminar.dataset.label = "Seminar";
        tdSeminar.textContent = ev.seminar_name || ev.seminar_id;
        tr.appendChild(tdSeminar);

        const tdSpeaker = document.createElement("td");
        tdSpeaker.className = "col-speaker";
        tdSpeaker.dataset.label = "Speaker";
        tdSpeaker.textContent = ev.speaker || "";
        tr.appendChild(tdSpeaker);

        const tdTitle = document.createElement("td");
        tdTitle.className = "col-title";
        tdTitle.dataset.label = "Title";
        const titleSpan = document.createElement("span");
        titleSpan.textContent = ev.title || "";
        tdTitle.appendChild(titleSpan);
        tr.appendChild(tdTitle);

        const tdTime = document.createElement("td");
        tdTime.dataset.label = "Time";
        tdTime.textContent = ev.time_info || "";
        tr.appendChild(tdTime);

        const tdLocation = document.createElement("td");
        tdLocation.dataset.label = "Location";
        tdLocation.textContent = ev.location || "";
        tr.appendChild(tdLocation);

        const tdLinks = document.createElement("td");
        tdLinks.dataset.label = "Links";
        const btnRow = document.createElement("div");
        btnRow.className = "btn-row";

        // IMPORTANT: this is the fix – use seminar_page, not the current page
        const seminarPageUrl = ev.seminar_page || ev.details_url;
        if (seminarPageUrl) {
          const series = document.createElement("a");
          series.href = seminarPageUrl;
          series.target = "_blank";
          series.rel = "noopener noreferrer";
          series.className = "btn btn-primary";
          series.textContent = "Open seminar page";
          btnRow.appendChild(series);
        }

        tdLinks.appendChild(btnRow);
        tr.appendChild(tdLinks);

        eventsBody.appendChild(tr);
      }
    }

    function applyFilters() {
      const q = (searchInput.value || "").trim().toLowerCase();
      const seminarId = seminarFilter.value || "all";

      let filtered = allEvents.slice();

      if (seminarId !== "all") {
        filtered = filtered.filter(ev => ev.seminar_id === seminarId);
      }

      if (q) {
        filtered = filtered.filter(ev => {
          return (
            (ev.title && ev.title.toLowerCase().includes(q)) ||
            (ev.speaker && ev.speaker.toLowerCase().includes(q)) ||
            (ev.location && ev.location.toLowerCase().includes(q)) ||
            (ev.seminar_name && ev.seminar_name.toLowerCase().includes(q))
          );
        });
      }

      filtered.sort((a, b) => a.date.localeCompare(b.date));
      render(filtered);
    }

    seminarFilter.addEventListener("change", applyFilters);
    searchInput.addEventListener("input", applyFilters);

    fetch("events.json", { cache: "no-store" })
      .then(resp => {
        if (!resp.ok) throw new Error("Failed to load events.json");
        return resp.json();
      })
      .then(data => {
        if (!Array.isArray(data)) {
          throw new Error("events.json must contain an array");
        }
        allEvents = data;
        allEvents.sort((a, b) => a.date.localeCompare(b.date));
        populateSeminarFilter(allEvents);
        applyFilters();
      })
      .catch(err => {
        console.error(err);
        eventsBody.innerHTML = "";
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 7;
        td.className = "empty";
        td.textContent = "Could not load events. Please try again later.";
        tr.appendChild(td);
        eventsBody.appendChild(tr);
        countBadge.textContent = "Error loading events";
      });
  </script>
</body>
</html>
